<!DOCTYPE html>
<html lang="es">
<head>
    <style>
        body { background: #0a0a0a; color: #00ff00; font-family: 'Courier New', monospace; padding: 50px; }
        .terminal-box { border: 1px solid #00ff00; padding: 20px; box-shadow: 0 0 15px rgba(0, 255, 0, 0.2); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #00ff00; padding: 10px; text-align: left; }
        th { background: rgba(0, 255, 0, 0.1); }
        
        /* Estilos para los botones de Rango */
        .btn-rank { text-decoration: none; padding: 3px 8px; border: 1px solid; margin-right: 5px; font-size: 0.8em; }
        .rank-user { color: #888; border-color: #888; }
        .rank-user:hover { background: #888; color: #000; }
        .rank-ing { color: #0088ff; border-color: #0088ff; }
        .rank-ing:hover { background: #0088ff; color: #000; }
        .rank-admin { color: #ffaa00; border-color: #ffaa00; }
        .rank-admin:hover { background: #ffaa00; color: #000; }

        .btn-delete { color: #ff0000; text-decoration: none; border: 1px solid #ff0000; padding: 5px; }
        .btn-delete:hover { background: #ff0000; color: #000; }
        .back { color: #00ff00; text-decoration: none; display: block; margin-bottom: 20px; }
        
        .flash-msg { background: rgba(0, 255, 0, 0.1); padding: 10px; border-left: 5px solid #00ff00; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="terminal-box">
        <a href="{{ url_for('grafos.index') }}" class="back">< [ VOLVER AL MAPA ]</a>
        
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            {% for message in messages %}
              <div class="flash-msg">> {{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <h1>[ TERMINAL DE GESTIÓN DE UNIDADES ]</h1>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>IDENTIFICADOR</th>
                    <th>RANGO ACTUAL</th>
                    <th>ASIGNAR NIVEL DE ACCESO</th>
                    <th>ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                {% for u in usuarios %}
                <tr>
                    <td>{{ u.id }}</td>
                    <td>{{ u.username }}</td>
                    <td style="color: {{ '#ff0000' if u.id == 1 else '#f7ad3d' }};">
                        {{ 'ADMINISTRADOR CENTRAL' if u.id == 1 else u.rol.upper() }}
                    </td>
                    <td>
                        {% if u.id != 1 %}
                            <a href="{{ url_for('grafos.cambiar_rango', id=u.id, nuevo_rol='usuario') }}" class="btn-rank rank-user">[ NIVEL 1 ]</a>
                            <a href="{{ url_for('grafos.cambiar_rango', id=u.id, nuevo_rol='ingeniero') }}" class="btn-rank rank-ing">[ NIVEL 2 ]</a>
                        {% else %}
                            <span style="color: #555;">[ RANGO FIJO ]</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if u.id != 1 %}
                            <a href="{{ url_for('grafos.eliminar_usuario', id=u.id) }}" class="btn-delete" onclick="return confirm('¿CONFIRMAR DESCONEXIÓN?')">[ ELIMINAR ]</a>
                        {% else %}
                            <span style="color: #ff0000;">[ PROTECCIÓN DE SISTEMA ]</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>